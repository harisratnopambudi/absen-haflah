<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Pengunjung</title>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <style>
        /* Styling dasar untuk body */
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
            background-color: #f9f9f9;
            color: #333;
        }
        /* Styling untuk judul utama */
        h1 {
            color: #0056b3;
            margin-bottom: 30px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        /* Styling untuk tabel daftar pengunjung */
        #visitor-list {
            width: 90%;
            max-width: 1000px; /* Lebar maksimum yang lebih luas */
            margin-top: 20px;
            border-collapse: collapse;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            border-radius: 10px;
            overflow: hidden;
        }
        /* Styling untuk header tabel (th) dan sel data (td) */
        #visitor-list th, #visitor-list td {
            border: 1px solid #e0e0e0;
            padding: 12px 15px;
            text-align: left;
        }
        /* Styling khusus untuk header tabel */
        #visitor-list th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        /* Styling untuk baris genap pada tabel */
        #visitor-list tr:nth-child(even) {
            background-color: #f2f7fc;
        }
        /* Styling untuk baris ganjil pada tabel */
        #visitor-list tr:nth-child(odd) {
            background-color: #ffffff;
        }
        /* Efek hover pada baris tabel */
        #visitor-list tr:hover {
            background-color: #e9f5ff;
            cursor: default;
        }
        /* Styling untuk pengunjung baru yang ditambahkan */
        .new-visitor {
            background-color: #d4edda !important;
            animation: fadeInOut 4s forwards;
        }

        /* Keyframes untuk animasi fade in dan fade out */
        @keyframes fadeInOut {
            0% { background-color: #d4edda; opacity: 0.5; }
            20% { background-color: #d4edda; opacity: 1; }
            80% { background-color: #d4edda; opacity: 1; }
            100% { background-color: #f9f9f9; opacity: 1; }
        }
    </style>
</head>
<body>

    <h1>Daftar Pengunjung</h1>
    <table id="visitor-list">
        <thead>
            <tr>
                <th>No.</th>
                <th>Nama Pengunjung</th>
                <th>Kelas</th> <!-- Kolom baru untuk Kelas -->
                <th>Waktu Scan</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data pengunjung akan ditambahkan di sini oleh JavaScript -->
        </tbody>
    </table>

    <script>
        // Konfigurasi Firebase Anda
        const firebaseConfig = {
            apiKey: "AIzaSyCMNdxvmAhrKgfwKNzPmSlfFtrbhlawYXE",
            authDomain: "absen-tamu-undangan-haflah.firebaseapp.com",
            databaseURL: "https://absen-tamu-undangan-haflah-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "absen-tamu-undangan-haflah",
            storageBucket: "absen-tamu-undangan-haflah.firebasestorage.app",
            messagingSenderId: "298086025599",
            appId: "1:298086025599:web:818f9a8cd794f0f023724a",
            measurementId: "G-P5E6HY528V"
        };

        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const visitorsRef = database.ref('pengunjung'); 

        const visitorListBody = document.querySelector('#visitor-list tbody');
        let visitorCount = 0;

        /**
         * Mengurutkan pengunjung berdasarkan timestamp dari yang terbaru.
         * @param {Array} visitorsArray - Array objek pengunjung.
         * @returns {Array} Array pengunjung yang sudah diurutkan.
         */
        function sortVisitorsByTimestamp(visitorsArray) {
            return visitorsArray.sort((a, b) => b.timestamp - a.timestamp);
        }

        /**
         * Memperbarui seluruh daftar pengunjung di tabel HTML.
         * Ini akan dipanggil setiap kali ada perubahan pada data pengunjung.
         * @param {object} visitorsObject - Objek data pengunjung dari Firebase.
         */
        function updateVisitorList(visitorsObject) {
            visitorListBody.innerHTML = '';
            visitorCount = 0;

            if (!visitorsObject) return;

            const visitorsArray = Object.keys(visitorsObject).map(key => ({
                id: key,
                ...visitorsObject[key]
            }));
            const sortedVisitors = sortVisitorsByTimestamp(visitorsArray);

            sortedVisitors.forEach(visitorData => {
                visitorCount++;

                const newRow = visitorListBody.insertRow();
                
                const cellNo = newRow.insertCell(0);
                const cellName = newRow.insertCell(1);
                const cellClass = newRow.insertCell(2); // Sel baru untuk Kelas
                const cellTime = newRow.insertCell(3);

                cellNo.textContent = visitorCount;
                cellName.textContent = visitorData.nama;
                cellClass.textContent = visitorData.kelas || 'Tidak Diketahui'; // Tampilkan kelas, default jika kosong

                const date = new Date(visitorData.timestamp);
                cellTime.textContent = date.toLocaleString('id-ID');

                setTimeout(() => {
                    newRow.classList.remove('new-visitor');
                }, 4000);
            });
        }

        // Mendengarkan data secara keseluruhan dari Firebase ('value' event)
        visitorsRef.on('value', (snapshot) => {
            const visitorsObject = snapshot.val();
            updateVisitorList(visitorsObject);
        }, (error) => {
            console.error("Error reading data from Firebase:", error);
        });
    </script>
</body>
</html>
