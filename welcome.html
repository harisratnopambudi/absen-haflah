<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selamat Datang Pengunjung!</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <style>
        /* Mengatur font Inter dan Reem Kufi dari Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Reem+Kufi:wght@400;500;600;700&display=swap');

        /* Styling dasar untuk body dan html agar mengisi seluruh viewport */
        html, body {
            width: 100vw; /* Mengisi seluruh lebar viewport */
            height: 100vh; /* Mengisi seluruh tinggi viewport */
            margin: 0;
            padding: 0;
            overflow: hidden; /* Mencegah scrollbar muncul */
        }

        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #2c3e50; /* Warna latar belakang gelap di luar bingkai */
            color: #4b4b4b; /* Warna teks default */
            text-align: center; /* Memastikan teks di tengah */
        }

        /* Kontainer utama untuk seluruh desain (bingkai) */
        .main-frame-container {
            background-color: #f7f3e9; /* Warna dasar krem/emas terang */
            /* Menggunakan URL pattern yang diunggah ke repository Anda */
            background-image: url('pattern.png'); /* GANTI 'pattern.png' DENGAN NAMA FILE ASLI ANDA */
            background-repeat: repeat; /* Mengulang pattern */
            /* Border telah dihapus */
            /* border-image juga dihapus */

            /* Hilangkan box-shadow di mode fullscreen untuk tampilan yang lebih bersih */
            box-shadow: none; 
            /* Hilangkan border-radius untuk mengisi sudut layar sepenuhnya */
            border-radius: 0; 

            /* Memastikan container mengisi seluruh viewport */
            width: 100vw; /* Mengisi seluruh lebar viewport */
            max-width: 100vw; /* Memastikan tidak ada overflow horizontal */
            height: 100vh; /* Mengisi seluruh tinggi viewport */
            max-height: 100vh; /* Memastikan tidak ada overflow vertikal */
            box-sizing: border-box; /* Pastikan padding dan border termasuk dalam lebar/tinggi */
            padding: 40px; /* Padding internal agar konten tidak menempel ke tepi */

            display: flex;
            flex-direction: column;
            justify-content: center; /* Perubahan untuk memusatkan secara vertikal */
            align-items: center;
            gap: 30px; /* Tambahkan jarak antar item flex (header, logo, welcome-message) */

            position: relative; /* Penting untuk penempatan footer-signature */
        }

        /* Bagian atas (HAFLAH IKHTITAM, SD PLUS 2, Tanggal) */
        .header-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            margin-bottom: 0; /* Hilangkan margin-bottom karena sudah ada gap di parent */
        }
        .header-section p {
            margin: 0;
            padding: 0;
            line-height: 1.2;
            color: #a87e35; /* Warna emas tua untuk teks header */
            font-weight: 600;
        }
        .header-section .title-main {
            font-size: 2.5em; /* Ukuran lebih besar */
            font-weight: 800;
            color: #7b5b2a;
            text-transform: uppercase;
            font-family: 'Reem Kufi', sans-serif; /* Font gaya Arab */
            line-height: 1.3; /* Menjaga spasi antar baris */
        }
        .header-section .title-sub {
            font-size: 1.8em; /* Ukuran lebih besar */
            font-weight: 700;
            color: #8b6e3e;
            font-family: 'Reem Kufi', sans-serif; /* Font gaya Arab */
            line-height: 1.3;
        }
        .header-section .date-text {
            font-size: 1.1em; /* Ukuran sedikit lebih besar */
            font-weight: 400;
            color: #a87e35;
            min-height: 1.2em; /* Mencegah CLS saat tanggal dimuat */
            
            /* STYLING BARU UNTUK BACKGROUND ROUNDED */
            background-color: rgba(255, 255, 255, 0.7); /* Background putih transparan */
            padding: 8px 15px; /* Padding di sekitar teks */
            border-radius: 10px; /* Sudut membulat */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Sedikit bayangan */
            display: inline-block; /* Agar padding dan background diterapkan dengan benar */
            margin-top: 10px; /* Jarak dari sub judul */
        }
        
        /* Styling untuk logo */
        .logo-container {
            margin: 15px 0 25px 0; /* Jarak atas, kiri/kanan, bawah */
            text-align: center;
        }
        .logo-container img {
            max-width: 100%; /* Memastikan gambar logo responsif terhadap lebar container */
            height: auto; /* Menjaga rasio aspek */
            max-height: 150px; /* Ukuran maksimum yang sedikit lebih besar */
            border-radius: 50%; /* Membuat logo bulat jika diperlukan */
            border: 2px solid #a87e35;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Kontainer untuk pesan selamat datang dinamis */
        #welcome-message-container {
            flex-grow: 1; /* Memungkinkan kontainer ini mengambil sisa ruang */
            display: flex;
            flex-direction: column;
            justify-content: center; /* Memusatkan konten secara vertikal */
            align-items: center;
            padding: 20px 0;
            /* Animasi akan diatur ulang di JavaScript */
            opacity: 0; 
            transform: scale(0.9);
            animation: fadeInScale 0.8s forwards; 
            transition: all 0.5s ease-in-out;
        }

        /* Styling untuk pesan "Assalamualaikum" */
        #greeting {
            font-size: 3em; /* Ukuran lebih besar */
            color: #7b5b2a; /* Warna emas gelap */
            margin-bottom: 15px;
            font-weight: 600;
            line-height: 1.3;
        }

        /* Styling untuk pesan "Selamat Datang" */
        .welcome-phrase {
            font-size: 2em; /* Ukuran lebih besar */
            color: #a87e35;
            font-weight: 500;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        /* Styling untuk nama pengunjung dinamis */
        #visitor-name-display { /* ID baru untuk nama pengunjung */
            font-size: 4.5em; /* Ukuran font sangat besar untuk nama */
            color: #4b4b4b; /* Warna teks lebih gelap untuk nama agar menonjol */
            font-weight: 800;
            line-height: 1.2;
            word-wrap: break-word;
            max-width: 100%;
        }
        
        /* Animasi muncul (fade in dan scale up) */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Styling untuk tanda tangan footer */
        #footer-signature {
            position: absolute; /* Posisikan secara absolut terhadap parent (main-frame-container) */
            bottom: 20px; /* Jarak dari bawah */
            right: 20px; /* Jarak dari kanan */
            font-size: 0.9em; /* Ukuran font lebih kecil */
            color: #8b6e3e; /* Warna teks emas yang lebih lembut */
            font-weight: 500;
            opacity: 0.7; /* Sedikit transparan */
        }


        /* Media queries untuk responsivitas */
        @media (max-width: 1024px) { /* Untuk tablet landscape dan desktop kecil */
            .header-section .title-main { font-size: 2em; }
            .header-section .title-sub { font-size: 1.5em; }
            #greeting { font-size: 2.5em; }
            .welcome-phrase { font-size: 1.8em; }
            #visitor-name-display { font-size: 3.8em; }
        }

        @media (max-width: 768px) { /* Untuk tablet portrait */
            .main-frame-container { 
                padding: 25px; 
                gap: 20px; /* Kurangi gap */
            }
            .header-section .title-main { font-size: 1.8em; }
            .header-section .title-sub { font-size: 1.2em; }
            .logo-container img { max-height: 100px; }
            #greeting { font-size: 2.2em; }
            .welcome-phrase { font-size: 1.5em; }
            #visitor-name-display { font-size: 3em; }
            #footer-signature {
                font-size: 0.8em;
                bottom: 15px;
                right: 15px;
            }
        }

        @media (max-width: 480px) { /* Untuk smartphone */
            .main-frame-container { 
                padding: 15px; 
                gap: 15px; /* Kurangi gap lagi */
            }
            .header-section .title-main { font-size: 1.5em; }
            .header-section .title-sub { font-size: 1em; }
            .logo-container img { max-height: 80px; }
            #greeting { font-size: 1.5em; }
            .welcome-phrase { font-size: 1.2em; }
            #visitor-name-display { font-size: 2.2em; }
            #footer-signature {
                font-size: 0.7em;
                bottom: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>

    <div class="main-frame-container">
        <div class="header-section">
            <p class="title-main">HAFLAH IKHTITAM</p>
            <p class="title-sub">SD PLUS 2 AL-MUHAJIRIN</p>
            <p class="date-text" id="realtime-date"></p>
        </div>

        <div class="logo-container">
            <!-- URL logo telah diganti dengan 'LOGO.png' -->
            <img src="LOGO.png" alt="Logo SD PLUS 2 Al-Muhajirin" onerror="this.onerror=null;this.src='https://placehold.co/120x120/a87e35/ffffff?text=LOGO';">
        </div>

        <div id="welcome-message-container">
            <div id="greeting">Assalamualaikum</div>
            <div class="welcome-phrase">Selamat datang orang tua Ananda</div>
            <div id="visitor-name-display"></div> <!-- Nama pengunjung akan muncul di sini -->
        </div>

        <!-- Tanda Tangan Footer Baru -->
        <div id="footer-signature">
            Build with love Haris Ratno Pambudi
        </div>
    </div>

    <script>
        // Konfigurasi Firebase Anda
        const firebaseConfig = {
            apiKey: "AIzaSyCMNdxvmAhrKgfwKNzPmSlfFtrbhlawYXE",
            authDomain: "absen-tamu-undangan-haflah.firebaseapp.com",
            databaseURL: "https://absen-tamu-undangan-haflah-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "absen-tamu-undangan-haflah",
            storageBucket: "absen-tamu-undangan-haflah.firebasestorage.app",
            messagingSenderId: "298086025599",
            appId: "1:298086025599:web:818f9a8cd794f0f023724a",
            measurementId: "G-P5E6HY528V"
        };

        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const visitorsRef = database.ref('pengunjung'); 

        const visitorNameDisplayElement = document.getElementById('visitor-name-display');
        const welcomeContainer = document.getElementById('welcome-message-container');
        const realtimeDateElement = document.getElementById('realtime-date'); // Elemen untuk tanggal realtime

        let lastDisplayedVisitorId = null;

        // Peta untuk konversi nama bulan Hijriyah (dari bahasa Inggris ke Indonesia/yang diinginkan)
        const hijriMonthMapping = {
            "Muharram": "Muharram",
            "Safar": "Safar",
            "Rabiʻ I": "Rabi' al-Awwal", // atau 'Rabiul Awal'
            "Rabiʻ II": "Rabi' al-Thani", // atau 'Rabiul Akhir'
            "Jumada I": "Jumada al-Ula", // atau 'Jumadil Awal'
            "Jumada II": "Jumada al-Thania", // atau 'Jumadil Akhir'
            "Rajab": "Rajab",
            "Shaʻban": "Sya'ban",
            "Ramadan": "Ramadhan",
            "Shawwal": "Syawal",
            "Dhū al-Qaʻdah": "Dhu al-Qa'dah", // atau 'Dzulkaidah'
            "Dhū al-Ḥijjah": "Dhu al-Hijjah" // atau 'Dzulhijah'
        };

        /**
         * Fungsi untuk memperbarui tanggal Masehi dan Hijriyah secara realtime.
         */
        function updateRealtimeDate() {
            const now = new Date();

            // Format tanggal Masehi (DD MONTHYYYY)
            const optionsGregorian = { day: 'numeric', month: 'long', year: 'numeric' };
            const gregorianDate = now.toLocaleDateString('id-ID', optionsGregorian).toUpperCase();

            // Format tanggal Hijriyah menggunakan Intl.DateTimeFormat
            let hijriDate = "Tanggal Hijriyah Tidak Diketahui";
            try {
                // Menggunakan 'en-US' locale untuk mendapatkan nama bulan dalam bahasa Inggris,
                // lalu mengonversinya ke nama bulan yang umum di Indonesia.
                const optionsHijri = {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    calendar: 'islamic-umalqura' // Sistem kalender Umalqura
                };
                const hijriParts = new Intl.DateTimeFormat('en-US', optionsHijri).formatToParts(now);
                let hijriDay, hijriMonthEnglish, hijriYear;
                for (const part of hijriParts) {
                    if (part.type === 'day') hijriDay = part.value;
                    if (part.type === 'month') hijriMonthEnglish = part.value;
                    if (part.type === 'year') hijriYear = part.value;
                }

                // Konversi nama bulan Hijriyah dari Inggris ke Indonesia/yang diinginkan
                const hijriMonthIndonesian = hijriMonthMapping[hijriMonthEnglish] || hijriMonthEnglish;

                hijriDate = `${hijriDay} ${hijriMonthIndonesian} ${hijriYear} H`;

            } catch (e) {
                console.warn("Gagal memformat tanggal Hijriyah:", e);
            }

            // Gabungkan dan tampilkan tanggal
            realtimeDateElement.textContent = `${gregorianDate} / ${hijriDate}`;
        }

        // Panggil fungsi update tanggal saat halaman dimuat
        document.addEventListener('DOMContentLoaded', updateRealtimeDate);
        // Perbarui tanggal setiap jam (atau bisa lebih sering jika diperlukan, misal setiap menit)
        setInterval(updateRealtimeDate, 60 * 60 * 1000); // Setiap 1 jam

        // Mendengarkan penambahan anak (child_added) ke node 'pengunjung'
        visitorsRef.on('child_added', (snapshot) => {
            const visitorData = snapshot.val();
            const visitorId = snapshot.key;

            if (visitorData.status === 'hadir' && visitorId !== lastDisplayedVisitorId) {
                const visitorName = visitorData.nama; 

                visitorNameDisplayElement.textContent = visitorName;
                lastDisplayedVisitorId = visitorId;

                welcomeContainer.style.animation = 'none'; 
                void welcomeContainer.offsetHeight; 
                welcomeContainer.style.animation = 'fadeInScale 0.8s forwards'; 
            }
        }, (error) => {
            console.error("Error reading data from Firebase in welcome.html:", error);
            visitorNameDisplayElement.textContent = 'Error memuat nama pengunjung.';
        });
    </script>
</body>
</html>
